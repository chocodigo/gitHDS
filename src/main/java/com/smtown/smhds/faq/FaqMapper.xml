<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.smtown.smhds.faq.FaqMapper">

    <!--
     *   프로그램명 : faq 게시판
     *   작 성 일 : 2019.05.28
     *   작 성 자 : 최해림
     *   비   고 :
     *   Copyright (c) 2019 SM Entertainment Co.,Ltd All Rights reserved.
     -->

    <!--
       /***********************************************************************************
           작  성  자 : 최해림
           작  성  일 : 2019.05.28
           내      용 : faq 게시판 게시글 갯수
           파라미터   : 게시글 명칭
       /***********************************************************************************
        -->
    <select id="faqCount" resultType="int">
        SELECT
        COUNT(*)	/*게시글 갯수*/
        FROM HD_FAQ
        <if test="search != ''">
            WHERE TITL_NAME LIKE '%' #{search} '%'
        </if>
    </select>


    <!--
	/***********************************************************************************
        작  성  자 : 최해림
        작  성  일 : 2019.05.28
        내      용 : 게시물 목록
        파라미터   : pageStart : 시작 페이지, perPageNum : 한 페이지당 보여줄 게시글의 갯수
    /***********************************************************************************
     -->
    <select id="faqList" resultType="com.smtown.smhds.faq.FaqVO">
        SELECT
        IDXX_NUMB		/*순번*/
        , TITL_NAME		/*제목*/
        , USER_NAME		/*이름*/
        , CONT_ENTS		/*내용*/
        , CREA_USER		/*생성자*/
        , CREA_DATE		/*생성일자*/
        , ROW_NUMBER() OVER (ORDER BY CREA_DATE) AS NUMB_KEYX	/*순번*/

        FROM HD_FAQ
        <if test="search != ''">
            WHERE TITL_NAME LIKE '%' #{search} '%'
        </if>
        ORDER BY CREA_DATE DESC
        LIMIT #{pageStart}, #{perPageNum}
    </select>


    <!--
/***********************************************************************************
    작  성  자 : 최해림
    작  성  일 : 2019.05.31
    내      용 : 자동완성기능 정보를 위해 제목 내용을 return
    파라미터   :
/***********************************************************************************
 -->
    <select id="faqSuggestion" resultType="String">
        SELECT
        TITL_NAME 		/*제목*/
        FROM HD_FAQ
        <if test="search != ''">
            WHERE TITL_NAME LIKE #{search} '%'
        </if>
        ORDER BY CREA_DATE DESC
        LIMIT 5
    </select>



    <!--
   /***********************************************************************************
       작  성  자 : 최해림
       작  성  일 : 2019.06.04
       내      용 : 메인 페이지에서 노출될 게시 글 목록
       파라미터   : limit : 노출될 게시글 목록갯수
   /***********************************************************************************
    -->
    <select id="faqListMain" resultType="com.smtown.smhds.faq.FaqVO">
    	SELECT
    	IDXX_NUMB		/*순번*/
    	, TITL_NAME		/*제목*/
    	, USER_NAME		/*이름*/
    	, CONT_ENTS		/*내용*/
    	, CREA_USER		/*생성자*/
    	, CREA_DATE		/*생성일자*/
    	, ROW_NUMBER() OVER (ORDER BY CREA_DATE) AS NUMB_KEYX	/*순번*/
    	FROM HD_FAQ
    	ORDER BY CREA_DATE DESC
		LIMIT 5
    </select>


    <!--
/***********************************************************************************
    작  성  자 : 최해림
    작  성  일 : 2019.05.28
    내      용 : 게시글 상세
    파라미터   : idxx_numb : 게시글 상세 번호
/***********************************************************************************
 -->
    <select id="faqDetail" parameterType="String" resultType="com.smtown.smhds.faq.FaqVO">
    	SELECT
    	IDXX_NUMB		/*순번*/
    	, TITL_NAME		/*제목*/
    	, USER_NAME		/*이름*/
    	, CONT_ENTS		/*내용*/
    	, CREA_USER		/*생성자*/
    	, CREA_DATE		/*생성일자*/
    	FROM HD_FAQ
    	WHERE IDXX_NUMB = #{idxx_numb}
    </select>

    <!--
	/***********************************************************************************
        작  성  자 : 최해림
        작  성  일 : 2019.05.28
        내      용 : faqIdxx PRIMARY KEY 생성을 위한 시퀸스 생성
        파라미터   :
    /***********************************************************************************
     -->
    <select id="faqSelectIdxx" resultType="String">
		SELECT
		CONCAT(replace(substr(CONVERT(now(), char),3,8),'-',''), 'FA','1',LPAD(ifnull(max(cast(substr(IDXX_NUMB, 12,2)as  decimal)),0) + 1,4,'0')) AS IDXX_NUMB
		FROM HD_FAQ
		WHERE 1=1
		AND SUBSTR(IDXX_NUMB,1,6) = replace(substr(CONVERT(now(), char),3,8),'-','')
	</select>

    <!--
	/***********************************************************************************
        작  성  자 : 최해림
        작  성  일 : 2019.05.28
        내      용 : 게시글 저장을 위한 insert Query
        파라미터   :
    /***********************************************************************************
     -->
    <insert id="faqInsert" parameterType="com.smtown.smhds.faq.FaqVO">
    	INSERT INTO HD_FAQ (		/* boardInsert 게시글 저장  [요청사항 저장]*/
    	IDXX_NUMB					/*순번*/
    	, TITL_NAME					/*이름*/
    	, USER_NAME					/*이름*/
    	, CONT_ENTS					/*내용*/
    	, CREA_USER					/*생성자*/
    	, CREA_DATE					/*생성일자*/
    	)
    	VALUES(
    	#{idxx_numb}				/*순번*/
    	,#{titl_name}				/*제목*/
    	,#{user_name}				/*이름*/
    	,#{cont_ents}				/*내용*/
    	,#{crea_user}				/*생성자*/
    	,now()						/*생성일자*/
    	)
    </insert>

    <!--
	/***********************************************************************************
        작  성  자 : 최해림
        작  성  일 : 2019.05.28
        내      용 : 게시글 삭제
        파라미터   :
    /***********************************************************************************
     -->
    <delete id="faqDelete">
    	DELETE FROM HD_FAQ WHERE IDXX_NUMB = #{idxx_numb}
    </delete>

    <!--
/***********************************************************************************
    작  성  자 : 최해림
    작  성  일 : 2019.05.30
    내      용 : 게시글 수정
    파라미터   :
/***********************************************************************************
 -->
    <update id="faqUpdate" parameterType="com.smtown.smhds.faq.FaqVO">
        UPDATE HD_FAQ
        SET
        <if test="titl_name != null">
            TITL_NAME = #{titl_name}
        </if>
        <if test="titl_name != null and cont_ents != null"> , </if>
        <if test="cont_ents != null">
            CONT_ENTS = #{cont_ents}
        </if>
        WHERE IDXX_NUMB = #{idxx_numb}
    </update>
</mapper>